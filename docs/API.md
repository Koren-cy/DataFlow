# DataFlow API 文档

本文档详细描述了DataFlow中所有节点的API接口、参数说明和使用示例。

## 目录

- [数据采集类节点](#数据采集类节点)
- [数据处理类节点](#数据处理类节点)
- [机器学习类节点](#机器学习类节点)
- [可视化类节点](#可视化类节点)
- [通用类型说明](#通用类型说明)

## 数据采集类节点

### ReadCSV

**功能**: 读取CSV文件并转换为DataFrame格式

**类别**: `数学建模/数据采集`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 文件路径 | STRING | ✓ | "" | CSV文件的完整路径 |

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 读取的CSV数据 |

#### 使用示例

```python
# 节点配置
{
    "文件路径": "/path/to/your/data.csv"
}
```

#### 注意事项

- 支持相对路径和绝对路径
- 自动检测文件编码
- 自动推断数据类型
- 文件路径中的引号会被自动去除

---

## 数据处理类节点

### DropNA

**功能**: 删除包含缺失值的行

**类别**: `数学建模/数据清洗`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 待处理的数据 |

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 清洗后的数据 |

### DropINF

**功能**: 删除包含无穷值的行

**类别**: `数学建模/数据清洗`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 待处理的数据 |

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 清洗后的数据 |

### Normalize

**功能**: 数据标准化处理

**类别**: `数学建模/数据预处理`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 待标准化的数据 |
| 标准化方法 | ENUM | ✓ | "Z-Score" | 标准化方法选择 |
| 指定列 | STRING | ✗ | "" | 要标准化的列名，逗号分隔 |

#### 标准化方法选项

- **Z-Score**: 零均值单位方差标准化
- **Min-Max**: 最小-最大值标准化
- **Robust**: 鲁棒标准化（基于中位数和四分位距）

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 标准化后的数据 |

### SelectColumns

**功能**: 选择指定的数据列

**类别**: `数学建模/特征选择`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 原始数据 |
| 选择列 | STRING | ✓ | "" | 要选择的列名，逗号分隔 |

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 选择后的数据 |

### BalanceData

**功能**: 处理不平衡数据集

**类别**: `数学建模/数据预处理`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 待平衡的数据 |
| 目标列 | STRING | ✓ | "" | 标签列名 |
| 平衡方法 | ENUM | ✓ | "SMOTE" | 平衡算法选择 |

#### 平衡方法选项

- **SMOTE**: 合成少数类过采样技术
- **RandomOverSampler**: 随机过采样
- **RandomUnderSampler**: 随机欠采样
- **ADASYN**: 自适应合成采样

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 平衡后的数据 |

---

## 机器学习类节点

### PCA

**功能**: 主成分分析降维

**类别**: `数学建模/降维算法`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 待降维的数据 |
| 目标维度 | INT | ✓ | 2 | 降维后的维度数 |
| 可视化类型 | ENUM | ✓ | "全部" | 生成的图表类型 |
| 指定列 | STRING | ✗ | "" | 参与PCA的列名 |
| 标签列 | STRING | ✗ | "" | 用于着色的标签列 |

#### 可视化类型选项

- **全部**: 生成所有类型的图表
- **碎石图**: 主成分贡献度图
- **散点图**: 2D/3D散点图
- **热力图**: 特征贡献度热力图
- **双标图**: 特征和样本的双重展示

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 降维后的数据 |

#### 生成的文件

- `碎石图.svg`: 主成分解释方差图
- `2D散点图.svg`: 二维散点图
- `3D散点图.svg`: 三维散点图（当维度≥3时）
- `特征贡献度热力图.svg`: 特征权重热力图
- `双标图.svg`: 样本和特征的联合展示

### UMAP

**功能**: 统一流形逼近与投影降维

**类别**: `数学建模/降维算法`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 待降维的数据 |
| 目标维度 | INT | ✓ | 2 | 降维后的维度数 |
| 邻居数量 | INT | ✓ | 15 | 局部邻居数量 |
| 最小距离 | FLOAT | ✓ | 0.1 | 嵌入空间中的最小距离 |
| 指定列 | STRING | ✗ | "" | 参与UMAP的列名 |
| 标签列 | STRING | ✗ | "" | 用于着色的标签列 |

#### 输出

| 输出名 | 类型 | 说明 |
|--------|------|------|
| 数据帧 | DATAFRAME | 降维后的数据 |

---

## 可视化类节点

### ShowAny

**功能**: 将任意类型数据转换为文本展示

**类别**: `数学建模/可视化`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| source | ANY | ✓ | - | 任意类型的数据 |

#### 输出

此节点为输出节点，在UI中直接显示文本结果。

#### 支持的数据类型

- 字符串：直接显示
- 数值类型：转换为字符串
- 布尔值：转换为字符串
- 复杂对象：尝试JSON序列化或字符串转换

### ShowDOM

**功能**: 在DOM容器中展示内容

**类别**: `数学建模/可视化`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 内容 | ANY | ✓ | - | 要展示的内容 |
| 容器类型 | ENUM | ✓ | "div" | HTML容器类型 |

#### 输出

此节点为输出节点，在Web界面中显示HTML内容。

### ShowPygwalker

**功能**: 使用Pygwalker进行交互式数据探索

**类别**: `数学建模/可视化`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 数据帧 | DATAFRAME | ✓ | - | 要探索的数据 |
| 主题 | ENUM | ✗ | "light" | 界面主题 |

#### 主题选项

- **light**: 浅色主题
- **dark**: 深色主题

#### 输出

此节点为输出节点，生成交互式数据探索界面。

### ShowStreamlit

**功能**: 在Streamlit应用中展示内容

**类别**: `数学建模/可视化`

#### 输入参数

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|--------|------|------|--------|------|
| 内容 | ANY | ✓ | - | 要展示的内容 |
| 应用标题 | STRING | ✗ | "DataFlow" | Streamlit应用标题 |

#### 输出

此节点为输出节点，在Streamlit界面中展示内容。

---

## 通用类型说明

### DATAFRAME

基于pandas DataFrame的数据结构，支持：

- 多种数据类型（数值、字符串、日期等）
- 索引和列名
- 缺失值处理
- 高效的数据操作

### STRING

文本字符串类型，支持：

- 单行和多行文本
- 特殊字符和Unicode
- 路径和文件名

### INT

整数类型，支持：

- 正整数和负整数
- 范围限制
- 步长控制

### FLOAT

浮点数类型，支持：

- 小数值
- 科学计数法
- 精度控制

### ENUM

枚举类型，提供：

- 预定义选项列表
- 单选功能
- 类型安全

### ANY

通用类型，可以接受：

- 任意Python对象
- 复杂数据结构
- 自定义类型

---

## 错误处理

### 常见错误类型

1. **ValueError**: 参数值不合法
2. **FileNotFoundError**: 文件路径不存在
3. **KeyError**: 列名不存在
4. **TypeError**: 数据类型不匹配
5. **MemoryError**: 内存不足

### 错误处理建议

1. **数据验证**: 在处理前检查数据完整性
2. **参数检查**: 确保参数在有效范围内
3. **内存管理**: 处理大数据时注意内存使用
4. **异常捕获**: 使用try-catch处理可能的异常

---

## 性能优化建议

### 数据处理优化

1. **批量处理**: 尽量减少节点间的数据传输
2. **内存管理**: 及时释放不需要的大型对象
3. **并行计算**: 利用多核CPU进行并行处理
4. **数据类型**: 选择合适的数据类型减少内存占用

### 可视化优化

1. **采样显示**: 大数据集时进行采样可视化
2. **图表缓存**: 重复使用已生成的图表
3. **格式选择**: 选择合适的图片格式（SVG vs PNG）
4. **分辨率控制**: 根据需要调整图表分辨率

---

## 版本兼容性

| DataFlow版本 | ComfyUI版本 | Python版本 |
|-------------|-------------|------------|
| 0.0.1 | 最新 | 3.8+ |

---

*最后更新: 2025年1月*